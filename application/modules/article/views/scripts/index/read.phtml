<?php $this->headTitle($this->escape($this->article['title'])); ?><article role="article">	<header>		<h1 itemprop="name"><?php echo $this->escape($this->article['title']); ?></h1>		<?php if (is_array($this->article) && array_key_exists('image', $this->article) && !empty($this->article['image'])) { ?>			<?php if (array_key_exists('image_alt', $this->article) && !empty($this->article['image_alt'])) { ?>				<?php $altAttribute = 'alt="'.$this->escape($this->article['image_alt']).'" '; ?>			<?php } else { ?>				<?php $altAttribute = ''; ?>			<?php } ?>			<img itemprop="image" src="<?php echo '/upload/images/'.$this->escape($this->article['image']); ?>" <?php echo $altAttribute; ?>/>		<?php } ?>		<?php echo '<div itemprop="description">'.$this->article['header'].'</div>'; ?>	</header>		<div class="clearfix"></div>		<?php echo $this->article['body']; ?>		<footer>		<div class="tags_title"><?php echo $this->translate('TAGS').':'; ?></div>		<?php if (is_array($this->article) && array_key_exists('tags', $this->article) && count($this->article['tags']) > 0) { ?>			<?php foreach($this->article['tags'] as $tag) { ?>				<?php if (!empty($tag['name'])) { ?>					<a class="btn btn-primary" href="<?php echo $this->url(array('id' => $tag['id']), 'articleindextag'); ?>"><?php echo $this->escape($tag['name']); ?></a>				<?php } ?>			<?php } ?>		<?php } ?>				<?php if (is_array($this->article) && array_key_exists('relatedArticles', $this->article) && !empty($this->article['relatedArticles'])) { ?>			<div id="related_articles">				<h4><?php echo $this->translate('RELATED_ARTICLES'); ?></h4>				<ul>					<?php foreach($this->article['relatedArticles'] as $relatedArticle) { ?>						<li><a href="/article/read/<?php echo $relatedArticle['_id']; ?>"><?php echo $relatedArticle['title']; ?></a></li>					<?php } ?>				</ul>			</div>		<?php } ?>                            <h4><?php echo $this->translate('COMMENTS'); ?></h4>                            <?php echo $this->commentForm; ?>                            <dialog id="comments">            <?php if (is_object($this->comments)) { ?>                <ul>                    <?php foreach($this->comments as $comment) { ?>                        <li>                            <?php echo $comment['name'].': '.$comment['comment']; ?>                            <?php $acl = Zend_Registry::get('Acl');                            // TODO: put the role detection into bootstrap or                            // plugin and insert it into session                            $auth = Zend_Auth::getInstance();                            if ($auth->hasIdentity()) {                                $user = $auth->getIdentity();                                $role = strtolower($user->role);                            } else {                                $user = '';                                $userConfiguration = Zend_Registry::get('UserConfiguration');                                $defaultRole = $userConfiguration->authentification->default->role;                                $role = $defaultRole;                            }                            $aclUser = new Chris_Acl_UserRole($user);                            $aclComment = new Chris_Acl_CommentResource($comment);                            //if ($acl->isAllowed($role, 'comment', 'edit')) {                            if ($acl->isAllowed($aclUser, $aclComment, 'edit')) {                            ?>                                <br>                                <a class="btn btn-primary" href="<?php echo $this->url(array('id' => (string) $comment['_id'],'article_id' => (string) $this->article['_id']), 'articlecomment'); ?>"><?php echo $this->translate('EDIT'); ?></a>                            <?php } ?>                        </li>                    <?php } ?>                </ul>            <?php } ?>        </dialog>	</footer>	</article>